/**
 * Shaderboy
 * =========
 *
 * @author Christian Engel <hello@wearekiss.com>
 * @license MIT
 * @version 1
 */
(function(){function x(c,b){function a(){e--;0>=e&&b(n,h)}var d=c.getAttribute("data-shader"),f,e=0,n={fragment:d,vertex:null},h=[];e++;if(m[d])q(d,m[scriptIdentifier].innerHTML);else if("#"===d.substr(0,1)){f=document.getElementById(d.substr(1));if(null===f){console.error("Unable to locate the script tag with id "+d);g.onerror();return}m[d]=f;q(d,f.innerHTML)}else f=new XMLHttpRequest,f.onload=function(b){m[d].innerHTML=b.target.responseText;q(d,b.target.responseText);a()},e++,f.open("GET",d),f.send(),
m[d]=document.createElement("script");f=[];var k,l;f.push(c.getAttribute("src"));h.push(null);for(k=0;5>=k&&c.hasAttribute("data-texture"+k);k++)f.push(c.getAttribute("data-texture"+k)),h.push(null);for(k=0;k<f.length;k++)if(l=f[k],m[l])h[k]=m[l];else if("#"===l.substr(0,1)){h[k]=document.getElementById(l.substr(1));if(null===h[k]){console.error("Unable to locate image tag with id "+l);g.onerror();return}m[l]=h[k]}else h[k]=m[l]=new Image,h[k].onload=function(){a()},e++,h[k].src=l;a()}function q(c,
b){g.fragmentShaders[c]&&console.log('Shader source with the id "'+c+'" already exists and has been replaced.');g.fragmentShaders[c]=b}function r(c,b,a){a=c.createShader(a);c.shaderSource(a,b);c.compileShader(a);return c.getShaderParameter(a,c.COMPILE_STATUS)?a:(console.log("Shader compilation failed"),c=c.getShaderInfoLog(a),console.error(c),g.onerror(),null)}function y(c,b,a,d){var f=Math.random().toString().split(".")[1];c.sbId=f;(b=c.getContext("experimental-webgl",{antialias:!0}))||(b=c.getContext("webgl"));
b.viewportWidth=c.width;b.viewportHeight=c.height;var e=b,n=e.createProgram(),h;h=r(e,g.defaultVertexShader,e.VERTEX_SHADER);a=r(e,g.fragmentShaders[a],e.FRAGMENT_SHADER);e.attachShader(n,h);e.attachShader(n,a);e.deleteShader(h);e.deleteShader(a);e.linkProgram(n);e.getProgramParameter(n,e.LINK_STATUS)?(e.useProgram(n),a=n):(console.error(e.getProgramInfoLog(n)),a=void 0);if(a){e=b.getAttribLocation(a,"position");n=b;h=Date.now();var k={time:b.getUniformLocation(a,"time"),image:b.getUniformLocation(a,
"image"),texture0:b.getUniformLocation(a,"texture0"),texture1:b.getUniformLocation(a,"texture1"),texture2:b.getUniformLocation(a,"texture2"),texture3:b.getUniformLocation(a,"texture3"),texture4:b.getUniformLocation(a,"texture4"),texture5:b.getUniformLocation(a,"texture5")},l=b,m=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,m);l.bufferData(l.ARRAY_BUFFER,new Float32Array(g.defaultVertex),l.STATIC_DRAW);m.itemSize=3;m.numItems=4;p[f]={canvas:c,gl:n,program:a,renderStart:h,textures:[],uniforms:k,attributes:{position:e,
vertexes:m}};b.enableVertexAttribArray(e);for(c=0;c<d.length;c++)p[f].textures.push(!0),a=b,e=d[c],n=c,h=a.createTexture(),a.activeTexture(a.TEXTURE0+n),a.bindTexture(a.TEXTURE_2D,h),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);b.clearColor(0,0,0,0);b.disable(b.DEPTH_TEST)}}
function t(){window.requestAnimationFrame(t);for(var c in p){var b=p[c],a=b.gl,d=b.canvas,f=b.attributes.vertexes,e=b.attributes.position;a.viewport(0,0,d.width,d.height);a.clear(a.COLOR_BUFFER_BIT);a.uniform1i(b.uniforms.image,0);a.uniform1f(b.uniforms.time,(Date.now()-b.renderStart)/1E3);for(d=0;d<b.textures.length;d++)b.textures[d]&&a.uniform1i(b.uniforms["texture"+d],d+1);a.bindBuffer(a.ARRAY_BUFFER,f);a.vertexAttribPointer(e,f.itemSize,a.FLOAT,!1,0,0);a.drawArrays(a.TRIANGLE_STRIP,0,f.numItems)}}
function u(c,b,a){var d=document.createElement("canvas");g.canvases.push(d);d.className=c.className+" shaderboy";v(d,c);x(c,function(f,e){b?(c.className+=" shaderboy-replaced",c.parentNode.insertBefore(d,c)):c.parentNode.replaceChild(d,c);y(d,c,f.fragment,e);setTimeout(function(){t(d)},1);a&&a(d)})}function v(c,b){var a=b.offsetHeight;c.width=b.offsetWidth;c.height=a}var g;window.shaderboy=g={};g.canvases=[];g.fragmentShaders={};g.defaultVertexShader="attribute vec2 position;varying vec2 pixelCoords;\nvoid main() {\ngl_Position = vec4(vec2(position * vec2(2,2)) - vec2(1,1), 0., 1.);\npixelCoords=position;}";
g.defaultVertex=[1,1,0,-1,1,0,1,-1,0,-1,-1,0];g.onerror=function(){};var m={},p={},w=null;g.webglSupported=!1;(function(){var c=document.createElement("canvas"),b;try{if((b=c.getContext("experimental-webgl"))||(b=c.getContext("webgl")),!b){console.log("Webgl is not supported on this platform.");return}}catch(a){console.log("Webgl is not supported on this platform.");return}g.webglSupported=!0})();g.autoReplace=function(){if(g.webglSupported)for(var c=document.querySelectorAll("[data-shader]"),b=0;b<
c.length;b++)u(c[b])};g.replace=function(c,b,a){g.webglSupported&&u(c,b,a)};window.addEventListener("resize",function(){clearTimeout(w);w=setTimeout(function(){for(var c=g.canvases,b=0;b<c.length;b++)v(c[b],c[b])},100)})})();